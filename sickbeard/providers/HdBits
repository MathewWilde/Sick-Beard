
√ë√≤
√•PÀÜRc           @   s  d  d k  Z  d  d k Z d  d k Z d  d k l Z l Z l Z d  d k l Z d  d k l Z d  d k	 l
 Z
 l Z d  d k l
 Z
 l Z y d  d k Z Wn# e j
 o d  d k l Z n Xd e i f d	 ‚Äû  ∆í  YZ d
 e i f d ‚Äû  ∆í  YZ e ∆í  Z d S(   i√ø√ø√ø√øN(   t   loggert   tvcachet
   exceptions(   t   helpers(   t   Quality(   t   ext
   AuthException(   t
   NameParsert   InvalidNameException(   t
   simplejsont   HDBitsProviderc           B   sS   e  Z d  ‚Äû  Z d ‚Äû  Z d ‚Äû  Z d ‚Äû  Z e d ‚Äû Z d ‚Äû  Z d d d d ‚Äû Z
 RS(   c         C   sS   t  i i |  d ∆í t |  _ t |  ∆í |  _ d |  _ d |  _ d |  _	 d |  _
 d  S(   Nt   HDBitss   https://hdbits.orgs   https://hdbits.ro/api/torrentss   http://hdbits.ro/download.php?(   t   generict   TorrentProvidert   __init__t   Falset   supportsBacklogt   HDBitsCachet   cachet   urlt
   search_urlt   rss_urlt   download_url(   t   self(    (    s   sickbeard\providers\hdbits.pyoR   "   s    				c         C   s   t  i S(   N(   t	   sickbeardt   HDBITS(   R   (    (    s   sickbeard\providers\hdbits.pyot	   isEnabled/   s    c         C   s5   t  i p t  i o t d |  i d ∆í ‚Äö n t S(   Ns$   Your authentication credentials for s     are missing, check your config.(   R   t   HDBITS_USERNAMEt   HDBITS_PASSKEYR   t   namet   True(   R   (    (    s   sickbeard\providers\hdbits.pyot
   _checkAuth2   s    c         C   s‚Äò   | d  j o |  i ∆í  Sd | j oh d | j o[ | i d ∆í d j oA t i d |  i d | d t i ∆í t d |  i d ∆í ‚Äö q¬ç n t S(   Nt   statust   messagei   u)   Incorrect authentication credentials for s    : s$   Your authentication credentials for s"    are incorrect, check your config.(	   t   NoneR   t   getR    t   logR   t   DEBUGR   R   (   R   t
   parsedJSON(    (    s   sickbeard\providers\hdbits.pyot   _checkAuthFromData9   s    
&c      	   C   sY  t  i d |  i d | i ∆í  ∆í |  i i ∆í  |  i i | | ∆í } t  i d t | ∆í t  i ∆í | p | o | S|  i	 |  i
 d |  i d | i d | ∆í ∆í} | p t  i d |  i
 t  i
 ∆í g  St i | ∆í } | d  j o# t  i d |  i d	 t  i
 ∆í g  S|  i | ∆í o>g  } | o d
 | j o | d
 } n% t  i d |  i d t  i
 ∆í g  } x√Ø| D]√£} |  i | ∆í \ } }	 y t ∆í  }
 |
 i | ∆í } Wn1 t j
 o% t  i d
 | d t  i ∆í qjn X| i i oJ | i | i j o3 t  i d | d t | i ∆í d t  i ∆í qjq‚Äìnk | i | i j p | i | i j oD t  i d | d t | i ∆í d t | i ∆í d t  i ∆í qjn |  i | ∆í } | i i | i | i | | ∆í p- t  i d | d t  i! | t  i ∆í qjn t  i d | d |	 t  i ∆í |  i" | g ∆í }
 |	 |
 _# | |
 _ | |
 _$ | i% |
 ∆í qjWn | S(   Nu
   Searching s    for u   Cache results: t	   post_datat   showt   episodeu   No data returned from u   Error trying to load s
    JSON datat   datau   Resulting JSON from s    isn't correct, not parsing itu   Unable to parse the filename s    into a valid episodeu   Episode s    didn't air on s
   , skipping its    isn't t   xu   Ignoring result s*    because we don't want an episode that is u
   Found result s    at (&   R    R$   R   t
   prettyNameR   t   updateCachet   searchCachet   strR%   t   getURLR   t   _make_post_data_JSONR)   t   ERRORR   t
   parse_jsonR"   R'   t   _get_title_and_urlR   t   parseR   t   WARNINGt   air_by_datet   air_datet   airdatet
   season_numbert   seasonR*   t   episode_numberst
   getQualityt   wantEpisodeR   t   qualityStringst	   getResultR   t   qualityt   append(   R   R*   t   manualSearcht   resultsR+   R&   t   itemst   itemt   titleR   t   myParsert   parse_resultRB   t   result(    (    s   sickbeard\providers\hdbits.pyot   findEpisodeE   s^    "
-
 	
,&="&			c         C   s?   | d } |  i  t i h | d d 6t i d 6∆í } | | f S(   NR   t   idt   passkey(   R   t   urllibt	   urlencodeR   R   (   R   RG   RH   R   (    (    s   sickbeard\providers\hdbits.pyoR5   ¬ç   s    
+c         C   s≈†   h t  i d 6t  i d 6d g d 6} | o, h | i d 6| i d 6| i d 6| d <n | o h | i d 6| d 6| d <n t i | ∆í S(	   Nt   usernameRN   i   t   categoryRM   R<   R*   t   tvdb(   R   R   R   t   tvdbidR<   R*   t   jsont   dumps(   R   R)   R*   R<   R(   (    (    s   sickbeard\providers\hdbits.pyoR2   ‚Äù   s    





N(   t   __name__t
   __module__R   R   R   R'   R   RL   R5   R"   R2   (    (    (    s   sickbeard\providers\hdbits.pyoR
       s   	
			H	R   c           B   s5   e  Z d  ‚Äû  Z d ‚Äû  Z d ‚Äû  Z d ‚Äû  Z d ‚Äû  Z RS(   c         C   s    t  i i |  | ∆í d |  _ d  S(   Ni   (   R   t   TVCacheR   t   minTime(   R   t   provider(    (    s   sickbeard\providers\hdbits.pyoR   ¬Æ   s    c         C   sP  |  i  ∆í  p d  S|  i d  ∆í o&|  i ∆í  } | o |  i ∆í  n g  St i d |  i i d ∆í |  i	 ∆í  t
 i | ∆í } | d  j o& t i d |  i i d t i ∆í g  S|  i | ∆í oi | o d | j o | d } n& t i d |  i i d t i ∆í g  Sx< | D] } |  i
 | ∆í qWqLt i d |  i i d	 ∆í ‚Äö n g  Sd  S(
   Nu	   Clearing s(    cache and updating with new informationu   Error trying to load s
    JSON feedR+   u   Resulting JSON from s    isn't correct, not parsing its   Your authentication info for s     is incorrect, check your config(   t   shouldUpdateR   R"   t   _getRSSDatat
   setLastUpdateR    R$   R[   R   t   _clearCacheR   R4   R3   t
   _parseItemR   R   (   R   R+   R&   RF   RG   (    (    s   sickbeard\providers\hdbits.pyoR.   ¬µ   s.    


!! !c         C   s%   |  i  i |  i  i d |  i  i ∆í  ∆íS(   NR(   (   R[   R1   R   R2   (   R   (    (    s   sickbeard\providers\hdbits.pyoR]   √ù   s    c         C   sz   |  i  i | ∆í \ } } | o2 | o+ t i d | t i ∆í |  i | | ∆í n& t i d |  i  i d t i ∆í d  Sd  S(   Nu   Adding item to results: u   The data returned from the s'    is incomplete, this result is unusable(   R[   R5   R    R$   R%   t   _addCacheEntryR   R3   (   R   RG   RH   R   (    (    s   sickbeard\providers\hdbits.pyoR`   √†   s    !c         C   s   |  i  i | ∆í S(   N(   R[   R'   (   R   R+   (    (    s   sickbeard\providers\hdbits.pyoR   √´   s    (   RW   RX   R   R.   R]   R`   R   (    (    (    s   sickbeard\providers\hdbits.pyoR   ¬¨   s
   		(		(   RO   R   R   R    R   R   R   t   sickbeard.commonR   t   sickbeard.exceptionsR   R   t   sickbeard.name_parser.parserR   R   RU   t   ImportErrort   libR	   R
   R
   RY   R   R[   (    (    (    s   sickbeard\providers\hdbits.pyot   <module>   s   ≈íB
